/*!
 * modag.js
 * (c) Dan Jarvis 2012 - License MIT
 */
!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()}("modag",this,function(){function e(e){setTimeout(e,20)}function t(e){window.console&&console.log&&console.log(e)}function n(e,t){var n;e=e||{};for(n in t)"object"==typeof t[n].constructor?e[n]=this._extend(e[n],t[n]):e[n]=t[n];return e}function r(e,t){if("undefined"==typeof e)return;if("string"==typeof e)$(t).toggleClass(e);else if(Array===e.constructor)for(var n in e)$(t).toggleClass(e[n])}function i(e,t){if("undefined"!=typeof e)for(var n in e)$(t).attr(n,e[n])}function s(e,t,n){if("undefined"!=typeof e)for(var r in e)$(t).on(r,e[r],n)}function o(e){var t,n,r=e.overlay;return"undefined"!=typeof e._overlayElement?e._overlayElement:("undefined"==typeof r?r=".overlay":r[0]!="#"&&r[0]!="."&&(r="."+r),t=$(r)[0],"undefined"!=typeof t?t:(n="<div ",r[0]=="#"?n+='id="'+r.substring(1)+'"':n+='class="'+r.substring(1)+'"',n+="></div>",$("body").append(n),e.overlay=r,$(r)[0]))}function u(e){return"undefined"!=typeof e._dialogElement?e._dialogElement:$(e.selector)[0]}function a(e,n,r){if("undefined"==typeof e||e.length===0){t("_fetchDialog called without a URL!");return}$.ajax({url:e,method:"get",success:function(e){$("body").append(e),"function"==typeof n&&n($("body").children().last())},error:function(){"function"==typeof r&&r()}})}function f(e){var t=n(this,e||{});t.preload&&"undefined"!=typeof t.url&&t._preload(t),t.trigger.selector&&t.trigger.event&&$(t.trigger.selector).on(t.trigger.event,function(e,t){t.show()},t)}function l(e){return new f(e)}return f.prototype={selector:undefined,classes:[],attributes:{},preload:!0,animate:!1,modal:!0,hideOnOverlayClick:!0,overlay:undefined,url:undefined,shown:undefined,hidden:undefined,trigger:{},content:{},_loaded:!1,_overlayElement:undefined,_dialogElement:undefined,show:function(e){var t=n(this,e||{});t._dialogElement=u(t),"undefined"==typeof t._dialogElement?a(t.url,function(e){t._dialogElement=e,t._fill()}):t._loaded?t._show():t._fill(!0)},hide:function(){this._hide()},set:function(e,t){if("object"!=typeof t)return;"undefined"==typeof this.content[e]?this.content[e]=t:this.content[e]=n(this.content[e],t),this._set(e)},destroy:function(){var e,t;this.trigger.selector&&this.trigger.event&&$(this.trigger.selector).off(this.trigger.event);if("object"==typeof this.content)for(e in this.content)if("object"==typeof e.events)for(t in e.events)$(e.selector,this._dialogElement).off(t);this.modal&&this._hideOverlay(this,function(){$(this._overlayElement).off("click")}),$(this._dialogElement).remove()},_set:function(e){var n,o=this.content[e];if("undefined"==typeof o){t("_set() encountered an invalid key: "+e);return}n=$(e,this._dialogElement);if("undefined"==typeof n){t("_set() could not find an element");return}o.text&&$(n).text(o.text),o.html&&$(n).html(o.html),r(o.classes,n),i(o.attributes,n),s(o.events,n,this)},_preload:function(){var n=this;e(function(){n._dialogElement=u(n),"undefined"==typeof n._dialogElement&&a(n.url,function(e){n._loaded=!0,n._dialogElement=e,n._fill()},function(){t("unable to fetch dialog from the server!")})})},_fill:function(e){var t;r(this.classes,this._dialogElement);if("object"==typeof this.content)for(t in this.content)this._set(t);e&&this._show()},_show:function(){var e=this;this.modal?this._showOverlay(function(){e._showDialog(function(){"function"==typeof e.shown&&e.shown(e)})}):this._showDialog(function(){"function"==typeof e.shown&&e.shown(e)})},_hide:function(){var e=this;this.modal?this._hideDialog(function(){e._hideOverlay(function(){"function"==typeof e.hidden&&e.hidden(e)})}):this._hideDialog(function(){"function"==typeof e.hidden&&e.hidden(e)})},_showOverlay:function(e){var t=this;"undefined"==typeof this._overlayElement&&(this._overlayElement=o(this)),this.hideOnOverlayClick&&$(this._overlayElement).on("click",function(){t.hide()}),this.animate?$(this._overlayElement).css({display:"block",opacity:0}).animate({opacity:.8,duration:250,complete:e}):($(this._overlayElement).show("block"),"function"==typeof e&&e())},_hideOverlay:function(e){var t=this;this.hideOnOverlayClick&&$(this._overlayElement).on("click",null),this.animate?$(this._overlayElement).animate({display:"none",opacity:0,duration:250,complete:function(){$(t._overlayElement).hide(),"function"==typeof e&&e()}}):($(this._overlayElement).hide(),"function"==typeof e&&e())},_showDialog:function(e){this.animate?$(this._dialogElement).css({display:"block","margin-top":"-1000px"}).animate({"margin-top":"-200px",duration:300,complete:e}):($(this._dialogElement).show("block"),"function"==typeof e&&e())},_hideDialog:function(e){var t=this;this.animate?$(this._dialogElement).animate({"margin-top":"-1000px",duration:300,complete:function(){$(t._dialogElement).hide(),"function"==typeof e&&e()}}):($(this._dialogElement).hide(),"function"==typeof e&&e())}},l})